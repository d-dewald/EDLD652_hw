---
title: "EDLD 652 Homework"
author: "Eliott Doyle, Diana DeWald"
date: "2/8/2022"
output:
  html_document: default
  pdf_document: default
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)

transit_cost <- read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-01-05/transit_cost.csv')

```

# Question 1: Use the transit costs data to reproduce the following plot. To do so, you will need to do a small amount of data cleaning, then calculate the means and standard errors (of the mean) for each country. Please filter to only counties with at least three observations. To use actual country names, rather than abbreviations, join your dataset with the output from the following

```{r q1, echo = FALSE, warning = FALSE, message = FALSE}

# removing the last 7 rows which contain many NA values

transit_cost <- transit_cost[-c(538, 539, 540, 541, 542, 543, 544), ]

library(countrycode)

country_codes <- countrycode::codelist %>% 
  select(country_name = country.name.en, country = ecb)


# joining datasets by country codes and removing other NAs
transit_new <- left_join(transit_cost, country_codes, by = "country")

transit_new <- transit_new[-c(141, 481, 482), ]

transit_new <-  subset(transit_new, select = -c(reference, end_year) )

# removing countries with less than 3 observations
transit_new <- transit_new %>%
  group_by(country_name) %>% 
  filter(n() >= 3)

transit_new$real_cost <- as.numeric(transit_new$real_cost)
transit_new$country_name <- as.factor(transit_new$country_name)

# adding mean and standard deviation columns
transit_new.1 <- transit_new %>%
  group_by(country_name) %>%
  summarize(mean_realcost = mean(real_cost, na.rm = TRUE),
            sd_realcost = sd(real_cost, na.rm = TRUE))
  
# adding standard error column

transit_new <- transit_new %>%
  group_by(country_name) %>%
  summarize(mean_realcost = mean(real_cost, na.rm = TRUE),
            sd_realcost = sd(real_cost, na.rm = TRUE))

  transit_new.1 <- transit_new %>%
    group_by(country_name) %>%
    mutate(sem_realcost = mean(sd_realcost)/sqrt(length(transit_new[])))
  
  
# preparing the plot
  
x <- c(10000, 20000, 30000)
cost <- data.frame(x)

se.1 <- (transit_new.1$mean_realcost - transit_new.1$sem_realcost)
se.2 <- (transit_new.1$mean_realcost + transit_new.1$sem_realcost)


transit_1 <- transit_new.1 %>% 
  ggplot(aes(x = mean_realcost,
             y = reorder(country_name, mean_realcost))) +
  geom_point(color = "cornflowerblue", size = 2) +
  xlim(0, 30000) +
  theme_classic() +
  labs(
    title = "Cost to build transit systems vary across countries",
    x = "Real Cost (In millions of dollars)",
    y = "Country",
    caption = "Data provided through #tidytuesday by the Transit Costs Project") +
    geom_linerange(aes(xmin= se.1, xmax= se.2)) +
    theme(plot.title = element_text(hjust = -0.9, vjust=2.12)) + 
    theme(plot.caption=element_text(size=10, hjust= 0.5)) +
    geom_vline(data = cost, aes(xintercept = x), color = "darkgrey")


transit_1  


```


# Question 2: Visualize the same relation, but displaying the uncertainty using an alternative method of your choosing.

```{r q2, echo = FALSE, warning = FALSE, message = FALSE}

# using standard deviation rather than standard error to visualize uncertainty:
sd.1 <- (transit_new.1$mean_realcost - transit_new.1$sd_realcost)
sd.2 <- (transit_new.1$mean_realcost + transit_new.1$sd_realcost)

transit_2 <- transit_new.1 %>% 
  ggplot(aes(x = mean_realcost,
             y = reorder(country_name, mean_realcost))) +
  geom_point(color = "aquamarine4", size = 2) +
  xlim(0, 30000) +
  theme_classic() +
  labs(
    title = "Cost to build transit systems vary across countries",
    x = "Real Cost (In millions of dollars)",
    y = "Country",
    caption = "Horizontal lines represent standard deviation") +
    geom_linerange(aes(xmin= sd.1, xmax= sd.2)) +
    theme(plot.title = element_text(hjust = -0.9, vjust=2.12)) + 
    theme(plot.caption=element_text(size=10, hjust= 0.5)) +
    geom_vline(data = cost, aes(xintercept = x), color = "darkgrey")

transit_2


```


# Question 3: Compute the mean length and real_cost by city. Reproduce the following plot.

### Hint: Look into scale_size_binned()


# Question 4:Using basically the same data, reproduce the following plot. Note youâ€™ll need the country_name column in your dataset.


# Question 5:Use the crime dataset to run the following code and fit the corresponding model. Note, it may take a moment to run.

```{r q5, echo = FALSE, warning = FALSE, message = FALSE}
# model_data <- crime %>% 
#  mutate(neighborhood_id = relevel(factor(neighborhood_id), ref = "barnum"))

# m <- glm(is_crime ~ neighborhood_id, 
#         data = model_data,
#         family = "binomial")

# tidied <- broom::tidy(m)

# ppoints(20)

# regis <- tidied %>% 
#  filter(term == "neighborhood_idregis")

# qnorm(ppoints(20), 
#      mean = regis$estimate,
#      sd = regis$std.error)
```